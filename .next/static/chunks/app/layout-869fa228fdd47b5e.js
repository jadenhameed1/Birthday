(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{53672:function(e,t,s){Promise.resolve().then(s.bind(s,65914)),Promise.resolve().then(s.bind(s,15227)),Promise.resolve().then(s.t.bind(s,66722,23)),Promise.resolve().then(s.t.bind(s,47960,23))},65914:function(e,t,s){"use strict";s.d(t,{default:function(){return c}});var n=s(57437),a=s(2265),i=s(280),o=s(65725);function r(e){let{onUploadComplete:t,maxSize:s=5,accept:r={"image/*":[".png",".jpg",".jpeg",".gif"],"application/*":[".pdf",".doc",".docx",".zip"]}}=e,[l,c]=(0,a.useState)(!1),[u,d]=(0,a.useState)(0),m=(0,a.useCallback)(async e=>{for(let n of(c(!0),d(0),e))try{if(n.size>1048576*s){alert("File ".concat(n.name," is too large. Maximum size is ").concat(s,"MB."));continue}let e=n.name.split(".").pop(),a="".concat(Math.random().toString(36).substring(2),"_").concat(Date.now(),".").concat(e),o="uploads/".concat(a),{error:r,data:l}=await i.O.storage.from("files").upload(o,n,{onUploadProgress:e=>{let t=e.loaded/e.total*100;d(t)}});if(r)throw r;let{data:{publicUrl:c}}=i.O.storage.from("files").getPublicUrl(o),{error:u}=await i.O.from("file_uploads").insert([{file_name:n.name,file_path:o,file_url:c,file_size:n.size,file_type:n.type,uploaded_at:new Date().toISOString()}]);if(u)throw u;null==t||t({name:n.name,url:c,size:n.size,type:n.type})}catch(e){console.error("Upload error:",e),alert("Failed to upload ".concat(n.name,": ").concat(e.message))}c(!1),d(0)},[s,t]),{getRootProps:h,getInputProps:f,isDragActive:x}=(0,o.uI)({onDrop:m,accept:r,multiple:!0});return(0,n.jsx)("div",{className:"space-y-4",children:(0,n.jsxs)("div",{...h(),className:"border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors ".concat(x?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"," ").concat(l?"opacity-50 cursor-not-allowed":""),children:[(0,n.jsx)("input",{...f(),disabled:l}),l?(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"text-blue-500",children:["Uploading... ",u.toFixed(0),"%"]}),(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,n.jsx)("div",{className:"bg-blue-500 h-2 rounded-full transition-all",style:{width:"".concat(u,"%")}})})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCC1"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:x?"Drop files here...":"Drag & drop files here, or click to select"}),(0,n.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Maximum file size: ",s,"MB"]})]})]})})}var l=s(84543);function c(){let[e,t]=(0,a.useState)(!1),[s,o]=(0,a.useState)([]),[c,u]=(0,a.useState)(""),[d,m]=(0,a.useState)([]),[h,f]=(0,a.useState)("General"),[x,g]=(0,a.useState)(12),[p,b]=(0,a.useState)(!1),v=(0,a.useRef)(null);(0,a.useEffect)(()=>{w(),N(),j()},[h]);let y=()=>{var e;null===(e=v.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,a.useEffect)(()=>{y()},[s]);let w=async()=>{let{data:e}=await i.O.from("chat_rooms").select("*").eq("is_private",!1);m(e||[])},N=async()=>{let{data:e}=await i.O.from("live_chat_messages").select("*").eq("room_id",h).order("created_at",{ascending:!0}).limit(100);o(e||[])},j=()=>{let t=i.O.channel("enhanced_live_chat").on("postgres_changes",{event:"INSERT",schema:"public",table:"live_chat_messages",filter:"room_id=eq.".concat(h)},t=>{o(e=>[...e,t.new]),"You"===t.new.user_name||e||l.H.notifyNewMessage(t.new)}).subscribe();return()=>t.unsubscribe()},_=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text",s=e||c;if(!s.trim())return;let{error:n}=await i.O.from("live_chat_messages").insert([{room_id:h,user_name:"You",message:s,message_type:t}]);n||(u(""),b(!1))},D=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),C=e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},k=e=>{if("file"===e.message_type){let t=e.message.split(" - "),s=t[0].replace("\uD83D\uDCCE ",""),a=t[1];return(0,n.jsxs)("div",{className:"flex items-center space-x-2 p-2 bg-blue-50 rounded border",children:[(0,n.jsx)("span",{className:"text-lg",children:"\uD83D\uDCCE"}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("div",{className:"font-medium text-sm",children:s}),(0,n.jsx)("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 text-xs hover:underline",children:"Download File"})]})]})}return(0,n.jsx)("div",{className:"text-sm",children:e.message})};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("button",{onClick:()=>t(!0),className:"fixed bottom-6 right-6 bg-blue-500 text-white p-4 rounded-full shadow-lg hover:bg-blue-600 transition z-40 flex items-center space-x-2",children:[(0,n.jsx)("span",{className:"text-xl",children:"\uD83D\uDCAC"}),(0,n.jsx)("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-pulse"})]}),e&&(0,n.jsxs)("div",{className:"fixed bottom-6 right-6 w-96 h-[500px] bg-white rounded-lg shadow-xl border z-50 flex flex-col",children:[(0,n.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-t-lg",children:(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-semibold",children:"Enhanced Live Chat"}),(0,n.jsxs)("p",{className:"text-blue-100 text-sm",children:[x," users online"]})]}),(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsx)("button",{onClick:()=>b(!p),className:"text-white hover:text-blue-200 p-1",title:"Attach files",children:"\uD83D\uDCCE"}),(0,n.jsx)("button",{onClick:()=>t(!1),className:"text-white hover:text-blue-200",children:"âœ•"})]})]})}),(0,n.jsx)("div",{className:"border-b bg-gray-50",children:(0,n.jsx)("select",{value:h,onChange:e=>f(e.target.value),className:"w-full p-2 text-sm border-none bg-transparent focus:ring-0",children:d.map(e=>(0,n.jsxs)("option",{value:e.name,children:["#",e.name]},e.id))})}),p&&(0,n.jsxs)("div",{className:"border-b bg-yellow-50 p-3",children:[(0,n.jsx)(r,{onUploadComplete:e=>{_("\uD83D\uDCCE ".concat(e.name," (").concat(C(e.size),") - ").concat(e.url),"file")},maxSize:10}),(0,n.jsx)("button",{onClick:()=>b(!1),className:"w-full mt-2 text-sm text-gray-500 hover:text-gray-700",children:"Cancel"})]}),(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50",children:[s.map((e,t)=>(0,n.jsx)("div",{className:"flex ".concat("You"===e.user_name?"justify-end":"justify-start"),children:(0,n.jsxs)("div",{className:"max-w-xs rounded-lg p-3 ".concat("You"===e.user_name?"bg-blue-500 text-white rounded-br-none":"bg-white border rounded-bl-none"),children:["You"!==e.user_name&&(0,n.jsx)("div",{className:"font-medium text-sm text-gray-700 mb-1",children:e.user_name}),k(e),(0,n.jsx)("div",{className:"text-xs mt-1 ".concat("You"===e.user_name?"text-blue-200":"text-gray-400"),children:D(e.created_at)})]})},e.id||t)),(0,n.jsx)("div",{ref:v})]}),(0,n.jsx)("div",{className:"border-t p-3 bg-white",children:(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsx)("input",{type:"text",value:c,onChange:e=>u(e.target.value),onKeyPress:e=>"Enter"===e.key&&_(),placeholder:"Type a message...",className:"flex-1 border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,n.jsx)("button",{onClick:()=>_(),disabled:!c.trim(),className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 disabled:opacity-50",children:"Send"})]})})]}),e&&(0,n.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>t(!1)})]})}},15227:function(e,t,s){"use strict";s.d(t,{default:function(){return a}});var n=s(2265);function a(){return(0,n.useEffect)(()=>([{href:"/api/ai/chat",as:"fetch"},{href:"/_next/static/css/",as:"style"}].forEach(e=>{let{href:t,as:s}=e,n=document.createElement("link");n.rel="preload",n.href=t,n.as=s,document.head.appendChild(n)}),"connection"in navigator&&(console.log("\uD83D\uDCCA Connection type:",navigator.connection.effectiveType),console.log("\uD83D\uDCCA Data saving mode:",navigator.connection.saveData)),()=>{document.querySelectorAll('link[rel="preload"]').forEach(e=>e.remove())}),[]),null}},280:function(e,t,s){"use strict";s.d(t,{O:function(){return n}});let n={from:()=>({select:()=>({order:()=>({limit:()=>Promise.resolve({data:[],error:null})}),eq:()=>Promise.resolve({data:[],error:null}),insert:()=>Promise.resolve({data:null,error:null})})})}},84543:function(e,t,s){"use strict";s.d(t,{H:function(){return a}});class n{async checkPermission(){if(!("Notification"in window)){console.log("This browser does not support notifications");return}this.permission=Notification.permission,"default"===this.permission&&(this.permission=await Notification.requestPermission())}async showNotification(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("granted"!==this.permission&&await this.checkPermission(),"granted"===this.permission){let s=new Notification(e,{icon:"/icon.png",badge:"/badge.png",...t});return s.onclick=()=>{window.focus(),s.close(),t.url&&(window.location.href=t.url)},setTimeout(()=>{s.close()},5e3),s}}async notifyNewBooking(e){return this.showNotification("\uD83C\uDF89 New Booking Received!",{body:"".concat(e.customer_name," booked your services for $").concat(e.budget),url:"/bookings",tag:"booking"})}async notifyNewMessage(e){return this.showNotification("\uD83D\uDCAC New Message",{body:"".concat(e.user_name,": ").concat(e.message),url:"/chat",tag:"message"})}async notifyPayment(e){return this.showNotification("\uD83D\uDCB0 Payment Received",{body:"Payment of $".concat(e," has been processed successfully"),url:"/bookings",tag:"payment"})}async notifyInfo(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/";return this.showNotification(e,{body:t,url:s})}constructor(){this.permission=null,this.checkPermission()}}let a=new n},47960:function(){}},function(e){e.O(0,[361,231,971,117,744],function(){return e(e.s=53672)}),_N_E=e.O()}]);